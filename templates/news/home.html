{% extends "base.html" %}
{% block title %}News · LocalLife{% endblock %}
{% block content %}
<section class="glass card">
  <div class="card-title">今日简报 · {{ today }}</div>
  <div class="card-subtitle">
    {% if digest %}生成于 {{ digest.generated_at|date:"H:i" }}{% else %}今日尚未生成（等调度任务跑完）{% endif %}
    · <a class="link" href="{% url 'news:preferences' %}">偏好设置</a>
    · <a class="link" href="{% url 'news:history' %}">历史</a>
  </div>

  {% if digest %}
    {% for e in digest.entries.all %}
      <div class="news-item">
        <div class="news-title">
          <a href="{% url 'news:item_detail' e.item.id %}">{{ e.rank }}. {{ e.item.title }}</a>
        </div>
        <div class="news-meta">
          {{ e.item.source.name }} · {{ e.item.published_at|date:"m-d H:i" }}
          · <a href="{{ e.item.url }}" target="_blank" rel="noreferrer">原文</a>
        </div>
        <div class="news-summary">{{ e.item.summary|truncatechars:220 }}</div>

        <form class="form news-pref" method="post" action="{% url 'news:toggle_item_state' e.item.id %}">
          {% csrf_token %}
          <button name="field" value="is_read" class="btn subtle" type="submit">已读</button>
          <button name="field" value="is_favorite" class="btn subtle" type="submit">收藏</button>
          <button name="field" value="is_later" class="btn subtle" type="submit">稍后读</button>
          <button name="field" value="is_blocked" class="btn danger" type="submit">屏蔽</button>
        </form>
      </div>
    {% endfor %}
  {% endif %}
</section>
{% endblock %}
