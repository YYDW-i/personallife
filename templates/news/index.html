{% extends "base.html" %}
{% block title %}News · LocalLife{% endblock %}

{% block content %}
<section class="glass card">
  <div class="cal-head">
    <div>
      <div class="card-title">News · 每日简报</div>
      <div class="card-subtitle">{{ date }} · 标题 + 2–4 句高密度摘要 + 原文链接</div>
    </div>
    <div class="cal-actions">
      <a class="btn subtle" href="{% url 'news:preferences' %}">偏好设置</a>
      <form method="POST" action="{% url 'news:refresh_today' %}">
        {% csrf_token %}
        <button type="submit" class="btn">刷新今日简报</button>
      </form>
    </div>
  </div>

  {% if not brief %}
    <div class="muted" style="margin-top:14px;">
      还没有生成今日简报。你可以点击“刷新今日简报”，或等待系统每日自动生成。
    </div>
  {% else %}
    <div style="display:flex; flex-direction:column; gap:12px; margin-top:14px;">
      {% for e in brief.entries.all %}
        <div class="glass" style="padding:14px; border-radius:16px;">
          <div style="font-weight:700; margin-bottom:6px;">{{ e.title }}</div>
          <div class="muted" style="line-height:1.7;">{{ e.summary}}</div>
          <div style="margin-top:8px; display:flex; gap:10px; align-items:center;">
            <span class="muted" style="font-size:12px;">来源：{{ e.source_name }}</span>
            <a class="btn subtle" href="{{ e.url }}" target="_blank" rel="noreferrer">打开原文</a>
          </div>
        </div>
      {% endfor %}
    </div>
  {% endif %}
</section>
{% endblock %}