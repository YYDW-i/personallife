{% extends "base.html" %}
{% block title %}Settings · LocalLife{% endblock %}

{% block content %}
  <style>
    /* ===== 扩展表单样式，适配两栏布局 ===== */
    .glass.card {
      position: relative;
    }

    .settings-form {
      margin-top: 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 2rem;
    }

    /* 两栏网格 */
    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 2rem 2.5rem;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .form-group label {
      font-weight: 600;
      color: var(--text);
      letter-spacing: 0.3px;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 0.8rem 1rem;
      border-radius: 14px;
      border: 1px solid var(--stroke);
      background: rgba(0, 0, 0, 0.2);
      color: var(--text);
      font-size: 1rem;
      outline: none;
      transition: border 0.2s, background 0.2s;
    }

    .form-group input:focus,
    .form-group select:focus {
      border-color: rgba(255, 255, 255, 0.3);
      background: rgba(0, 0, 0, 0.25);
    }

    .form-group input::placeholder {
      color: rgba(255, 255, 255, 0.4);
    }

    /* 右侧列容器：垂直排列 */
    .right-column {
      display: flex;
      flex-direction: column;
      gap: 1.2rem;
    }

    /* 年龄和性别并排行 */
    .row-fields {
      display: flex;
      gap: 1rem;
    }

    .row-fields .form-group {
      flex: 1;  /* 两个字段各占一半宽度 */
    }

    /* 信息卡片 */
    .info-card {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      padding: 1.2rem;
      border-left: 4px solid #4a9eff;
      backdrop-filter: blur(4px);
    }

    .info-card p {
      margin: 0 0 0.5rem 0;
      color: var(--muted);
      font-size: 0.95rem;
      line-height: 1.5;
    }

    .info-icon {
      font-size: 1.4rem;
      margin-right: 0.5rem;
      vertical-align: middle;
      opacity: 0.9;
    }

    .submit-btn {
      grid-column: 1 / -1;
      justify-self: center;
      padding: 0.9rem 3rem;
      font-size: 1.2rem;
      font-weight: 600;
      border: none;
      border-radius: 40px;
      background: rgba(255, 255, 255, 0.15);
      color: var(--text);
      border: 1px solid var(--stroke);
      cursor: pointer;
      backdrop-filter: blur(8px);
      transition: background 0.2s, transform 0.1s;
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
    }

    .submit-btn:hover {
      background: rgba(255, 255, 255, 0.25);
    }

    .submit-btn:active {
      transform: scale(0.98);
    }

    /* 移动端：改为单列 */
    @media (max-width: 700px) {
      .form-grid {
        grid-template-columns: 1fr;
        gap: 1.5rem;
      }
      .right-column {
        gap: 1rem;
      }
      .row-fields {
        flex-direction: column;  /* 小屏幕上年龄和性别也改为上下排列 */
        gap: 1rem;
      }
    }

    /* 原有遮罩样式保持不变 */
    .form-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(2px);
      display: none;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      z-index: 10;
      border-radius: inherit;
    }
    .loader {
      border: 6px solid #f3f3f3;
      border-top: 6px solid #3498db;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1.5s linear infinite;
      margin-bottom: 10px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .form-overlay p {
      color: #333;
      font-weight: 500;
      margin: 0;
    }
  </style>

  <section class="glass card">
    <div class="card-title">Settings</div>
    <div class="card-subtitle">填写后 Dashboard 会显示健康摘要</div>

    <form method="post" class="settings-form" id="settingsForm">
      {% csrf_token %}

      <div class="form-grid">
        <!-- 左侧列：身高、体重各占一行 -->
        <div class="form-group">
          <label for="height">身高 (cm)</label>
          <input type="number" name="height_cm" id="height"
                 value="{{ form.height_cm.value|default_if_none:'' }}"
                 placeholder="例如 180" required>
        </div>

        <div class="form-group">
          <label for="weight">体重 (kg)</label>
          <input type="number" name="weight_kg" id="weight"
                 value="{{ form.weight_kg.value|default_if_none:'' }}"
                 placeholder="例如 50" required>
        </div>

        <div class="form-group">
          <label for="exercise_frequency">运动频率 (次/周)</label>
          <input type="number" name="exercise_frequency" id="exercise_frequency"
                 value="{{ form.exercise_frequency.value|default_if_none:'' }}"
                 placeholder="例如 3" required>
        </div>

        <div class="form-group">
          <label for="exercise_time_minutes">运动时间（分钟/次）</label>
          <input type="number" name="exercise_time_minutes" id="exercise_time_minutes"
                 value="{{ form.exercise_time_minutes.value|default_if_none:'' }}"
                 placeholder="例如 30" required>
        </div>

        <div class="form-group">
          <label for="sleep_hours">近期平均睡眠时间（小时）</label>
          <input type="number" name="sleep_hours" id="sleep_hours"
                 value="{{ form.sleep_hours.value|default_if_none:'' }}"
                 placeholder="例如 7" required>
        </div>

        <!-- 右侧列：年龄性别并排 + 信息卡片 -->
        <div class="right-column">
          <div class="row-fields">
            <div class="form-group">
              <label for="age">年龄</label>
              <input type="number" name="age_year" id="age"
                     value="{{ form.age_year.value|default_if_none:'' }}"
                     placeholder="例如 20" required>
            </div>

            <div class="form-group">
              <label for="gender">性别</label>
              <select name="gender" id="gender" required>
                <option value="" disabled {% if not form.gender.value %}selected{% endif %}>请选择</option>
                <option value="M" {% if form.gender.value == "M" %}selected{% endif %}>男</option>
                <option value="F" {% if form.gender.value == "F" %}selected{% endif %}>女</option>
              </select>
            </div>
          </div>

        </div>
      </div>

      <button type="submit" class="submit-btn">保存</button>
    </form>

    <div class="form-overlay" id="formOverlay">
      <div class="loader"></div>
      <p>处理中，请稍候...</p>
    </div>
  </section>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const form = document.getElementById('settingsForm');
      const overlay = document.getElementById('formOverlay');

      if (form) {
        form.addEventListener('submit', function(e) {
          if (form.checkValidity()) {
            overlay.style.display = 'flex';
            const submitBtn = form.querySelector('button[type="submit"]');
            if (submitBtn) submitBtn.disabled = true;
          }
        });
      }
    });
  </script>
{% endblock %}